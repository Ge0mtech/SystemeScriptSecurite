# Syst√®me, Scripts et S√©curit√©

Projet complet d'administration syst√®me et de s√©curisation de scripts bash avec exploitation d'API, surveillance syst√®me et automatisation des t√¢ches.

## üìã Sommaire du projet

1. [Cr√©ation d'une VM Debian](#1-cr√©ation-dune-vm-debian)
2. [Commandes de recherche avanc√©e](#2-commandes-de-recherche-avanc√©e)
3. [Compression et d√©compression](#3-compression-et-d√©compression)
4. [Manipulation de texte](#4-manipulation-de-texte)
5. [Gestion des processus](#5-gestion-des-processus)
6. [Surveillance des ressources](#6-surveillance-des-ressources)
7. [Scripting avanc√©](#7-scripting-avanc√©)
8. [Automatisation des mises √† jour](#8-automatisation-des-mises-√†-jour)
9. [Gestion des d√©pendances](#9-gestion-des-d√©pendances)
10. [S√©curisation des scripts](#10-s√©curisation-des-scripts)
11. [Utilisation d'API Web](#11-utilisation-dapi-web)

---

## 1. Cr√©ation d'une VM Debian

### Configuration initiale
- **VM Debian** avec interface graphique
- **Nom de session :** La_Plateforme
- **Mot de passe :** LAPlateforme_
- **Architectures support√©es :** AMD64 / ARM64

### Pr√©requis syst√®me
```bash
# V√©rification de la connectivit√© r√©seau
ping -c 3 google.com

# Mise √† jour initiale
sudo apt update && sudo apt upgrade -y
```

---

## 2. Commandes de recherche avanc√©e

### Cr√©ation des fichiers de test
Cr√©er 5 fichiers "mon_texte.txt" contenant "Que la force soit avec toi." dans diff√©rents r√©pertoires.

```bash
# Script de cr√©ation automatique
for dir in Bureau Documents T√©l√©chargements Vid√©os Images; do
    echo "Que la force soit avec toi." > ~/"$dir"/mon_texte.txt
done
```

### Recherche avec le mot "force"
```bash
# Localiser tous les fichiers contenant "force"
find ~/ -name "mon_texte.txt" -exec grep -l "force" {} \;
```

**R√©sultat attendu :** 5 fichiers trouv√©s dans les r√©pertoires sp√©cifi√©s.

---

## 3. Compression et d√©compression

### Cr√©ation du r√©pertoire "Plateforme"
```bash
# Cr√©er le r√©pertoire et dupliquer les fichiers
mkdir -p ~/Documents/Plateforme
for i in {1..4}; do 
    cp ~/Documents/mon_texte.txt ~/Documents/Plateforme/mon_texte_$i.txt
done
cp ~/Documents/mon_texte.txt ~/Documents/Plateforme/
```

### Archivage avec tar et gzip
```bash
# Compression avec diff√©rentes options
tar czvf Plateforme.tar.gz -C ~/Documents Plateforme     # Compression gzip
tar cjvf Plateforme.tar.bz2 -C ~/Documents Plateforme    # Compression bzip2
tar cJvf Plateforme.tar.xz -C ~/Documents Plateforme     # Compression xz
```

### D√©compression
```bash
# D√©compression selon le format
tar xzvf Plateforme.tar.gz     # gzip
tar xjvf Plateforme.tar.bz2    # bzip2
tar xJvf Plateforme.tar.xz     # xz
```

---

## 4. Manipulation de texte

### Script Python pour g√©n√©rer un CSV
```python
# generer_csv.py
import csv

data = [
    ["Nom", "Age", "Ville"],
    ["Jean", 25, "Paris"],
    ["Marie", 30, "Lyon"],
    ["Pierre", 22, "Marseille"],
    ["Sophie", 35, "Toulouse"]
]

with open("data.csv", "w", newline="", encoding="utf-8") as fichier:
    writer = csv.writer(fichier)
    writer.writerows(data)

print("Fichier CSV cr√©√© avec succ√®s !")
```

### Extraction avec awk
```bash
# Ex√©cuter le script Python
python3 generer_csv.py

# Extraire la colonne "Ville" (3√®me colonne)
awk -F, 'NR > 1 {print $3}' data.csv
```

**R√©sultat :**
```
Paris
Lyon
Marseille
Toulouse
```

---

## 5. Gestion des processus

### Lister les processus actifs
```bash
# Voir tous les processus
ps aux

# Processus en temps r√©el
top
htop  # Plus moderne et interactif
```

### Terminer un processus
```bash
# Terminaison normale (SIGTERM)
kill PID

# Terminaison par nom de processus
pkill nom_processus

# Terminaison forc√©e (SIGKILL)
kill -9 PID
kill -KILL PID

# Terminaison forc√©e par nom
pkill -9 nom_processus
```

### Diff√©rences entre terminaisons
- **SIGTERM (kill)** : Permet au processus de se terminer proprement
- **SIGKILL (kill -9)** : Terminaison imm√©diate sans nettoyage

---

## 6. Surveillance des ressources

### Script de surveillance temps r√©el
```bash
#!/bin/bash
# monitor_system.sh

# En-t√™te CSV
echo "Timestamp,CPU User,CPU System,CPU Idle,Memory Free,Memory Used,Disk Read,Disk Write,Network In,Network Out" > stats.csv

# Capture des donn√©es (5 iterations)
for i in {1..5}; do
    # Statistiques syst√®me
    vmstat_output=$(vmstat 1 1)
    cpu_user=$(echo "$vmstat_output" | awk 'NR==3 {print $13}')
    cpu_system=$(echo "$vmstat_output" | awk 'NR==3 {print $14}')
    cpu_idle=$(echo "$vmstat_output" | awk 'NR==3 {print $15}')
    memory_free=$(echo "$vmstat_output" | awk 'NR==3 {print $4}')
    memory_used=$(echo "$vmstat_output" | awk 'NR==3 {print $3}')

    # Statistiques disque
    iostat_output=$(iostat -d 1 1)
    disk_read=$(echo "$iostat_output" | awk 'NR==4 {print $3}')
    disk_write=$(echo "$iostat_output" | awk 'NR==4 {print $4}')

    # Statistiques r√©seau
    netstat_output=$(netstat -i)
    network_in=$(echo "$netstat_output" | awk 'NR==4 {print $4}')
    network_out=$(echo "$netstat_output" | awk 'NR==4 {print $8}')

    # √âcriture dans le CSV
    echo "$(date),$cpu_user,$cpu_system,$cpu_idle,$memory_free,$memory_used,$disk_read,$disk_write,$network_in,$network_out" >> stats.csv
    
    sleep 1
done
```

### Commandes de surveillance en temps r√©el
```bash
# CPU et m√©moire
htop

# Utilisation disque
df -h
du -sh /*

# Processus r√©seau
netstat -tuln
ss -tuln
```

---

## 7. Scripting avanc√©

### Script de sauvegarde automatique
```bash
#!/usr/bin/env bash
# backup_plateforme.sh

set -euo pipefail

# Configuration
SRC="/home/La_Plateforme/Documents/Plateforme"
DEST_BASE="/home/La_Plateforme/Backups/Plateforme"
LOG_FILE="${DEST_BASE}/backup_history.log"

# Cr√©ation du r√©pertoire de destination
mkdir -p "${DEST_BASE}"

# G√©n√©ration du timestamp
TIMESTAMP=$(date +'%Y%m%d_%H%M%S')
ARCHIVE="${DEST_BASE}/Plateforme_${TIMESTAMP}.tar.gz"

# Logging du d√©but
echo "[$(date +'%Y-%m-%d %H:%M:%S')] D√©but sauvegarde : ${SRC} -> ${ARCHIVE}" | tee -a "${LOG_FILE}"

# Cr√©ation de l'archive
tar -czf "${ARCHIVE}" -C "$(dirname "${SRC}")" "$(basename "${SRC}")"
EXIT_CODE=$?

# Logging du r√©sultat
if [ ${EXIT_CODE} -eq 0 ]; then
    echo "[$(date +'%Y-%m-%d %H:%M:%S')] Sauvegarde r√©ussie : ${ARCHIVE}" | tee -a "${LOG_FILE}"
else
    echo "[$(date +'%Y-%m-%d %H:%M:%S')] √âchec sauvegarde (code ${EXIT_CODE})" | tee -a "${LOG_FILE}" >&2
    exit ${EXIT_CODE}
fi
```

### Automatisation avec cron
```bash
# Ajouter √† crontab pour ex√©cution quotidienne √† 2h
crontab -e
# Ajouter : 0 2 * * * /home/La_Plateforme/backup_plateforme.sh
```

---

## 8. Automatisation des mises √† jour

### Script de mise √† jour interactive
```bash
#!/usr/bin/env bash
# update_system.sh

set -euo pipefail

# V√©rification des privil√®ges root
if [ "$EUID" -ne 0 ]; then
    echo "Ce script doit √™tre ex√©cut√© avec sudo"
    exit 1
fi

echo "=== Mise √† jour du syst√®me Debian ==="

# Mise √† jour de la liste des paquets
echo "üì¶ Mise √† jour de la liste des paquets..."
apt update

# Affichage des mises √† jour disponibles
echo -e "\nüìã Mises √† jour disponibles :"
apt list --upgradable

# Demande de confirmation
echo ""
read -p "Voulez-vous installer ces mises √† jour ? [y/N] " -n 1 -r
echo

if [[ $REPLY =~ ^[Yy]$ ]]; then
    echo "üöÄ Installation des mises √† jour..."
    apt upgrade -y
    echo "‚úÖ Mise √† jour termin√©e avec succ√®s"
else
    echo "‚ùå Mise √† jour annul√©e"
fi
```

---

## 9. Gestion des d√©pendances

### Script d'installation serveur web complet
```bash
#!/usr/bin/env bash
# install_webserver.sh

set -euo pipefail

# V√©rification des droits root
if [[ $EUID -ne 0 ]]; then
    echo "‚ùå Ce script doit √™tre ex√©cut√© avec sudo"
    exit 1
fi

export DEBIAN_FRONTEND=noninteractive

echo "üöÄ Installation d'un serveur web complet"

# Mise √† jour syst√®me
echo "üì¶ Mise √† jour des paquets..."
apt update
apt install -y apt-transport-https curl gnupg ca-certificates lsb-release

# Installation Apache2
echo "üåê Installation d'Apache2..."
apt install -y apache2
systemctl enable --now apache2

# Installation MariaDB
echo "üóÑÔ∏è Installation de MariaDB..."
apt install -y mariadb-server
systemctl enable --now mariadb

# Configuration phpMyAdmin (non-interactive)
echo "üêò Installation de phpMyAdmin..."
printf "phpmyadmin phpmyadmin/dbconfig-install boolean true
phpmyadmin phpmyadmin/mysql/admin-pass password
phpmyadmin phpmyadmin/mysql/app-pass password
phpmyadmin phpmyadmin/app-password-confirm password
phpmyadmin phpmyadmin/reconfigure-webserver multiselect apache2" | debconf-set-selections

apt install -y phpmyadmin php libapache2-mod-php php-mbstring php-zip php-gd php-curl

# Activation de phpMyAdmin
a2enconf phpmyadmin
systemctl reload apache2

# Installation Node.js (LTS)
echo "‚ö° Installation de Node.js..."
curl -fsSL https://deb.nodesource.com/setup_lts.x | bash -
apt install -y nodejs

# Installation Git
echo "üìã Installation de Git..."
apt install -y git

# Affichage des informations
IP=$(hostname -I | awk '{print $1}')
echo ""
echo "‚úÖ Installation termin√©e !"
echo "üåê Apache : http://${IP}"
echo "üêò phpMyAdmin : http://${IP}/phpmyadmin"
echo "‚ö° Node.js version : $(node --version)"
echo "üìã Git version : $(git --version)"
```

---

## 10. S√©curisation des scripts

### Mesures de s√©curit√© appliqu√©es

#### Mode strict bash
```bash
#!/usr/bin/env bash
set -euo pipefail
# -e : Arr√™t sur erreur
# -u : Erreur sur variable non d√©finie  
# -o pipefail : Erreur dans les pipes
```

#### Validation des entr√©es
```bash
# Validation des param√®tres
validate_input() {
    local input="$1"
    # √âchapper les caract√®res dangereux
    if [[ "$input" =~ [';|&$`] ]]; then
        echo "‚ùå Caract√®res dangereux d√©tect√©s" >&2
        exit 1
    fi
}
```

#### Protection des donn√©es sensibles
```bash
# Masquage des informations sensibles dans les logs
log_safe() {
    local message="$1"
    # Masquer les cl√©s API/mots de passe
    echo "$message" | sed 's/api_key=[^&]*/api_key=***HIDDEN***/g'
}
```

### Risques identifi√©s et solutions

| Risque | Impact | Solution appliqu√©e |
|--------|---------|-------------------|
| Injection de commandes | Ex√©cution de code malveillant | Validation stricte des entr√©es |
| Variables non d√©finies | Comportement impr√©visible | `set -u` |
| Erreurs silencieuses | Masquage de probl√®mes | `set -e` et logging |
| Exposition de secrets | Compromission s√©curitaire | Fichiers `.env` et masquage |

---

## 11. Utilisation d'API Web

### Script OpenWeather s√©curis√©

#### Configuration et installation
```bash
# install.sh
#!/usr/bin/env bash
set -euo pipefail

echo "üå§Ô∏è Configuration de l'API OpenWeather"

# Cr√©ation du fichier .env s'il n'existe pas
if [[ ! -f .env ]]; then
    read -p "Entrez votre cl√© API OpenWeather : " -s api_key
    echo
    
    cat > .env << EOF
API_KEY=${api_key}
DEFAULT_CITY=Paris
DEFAULT_UNITS=metric
EOF
    
    echo "‚úÖ Configuration sauvegard√©e dans .env"
else
    echo "‚ÑπÔ∏è Fichier .env existant trouv√©"
fi

# Cr√©ation du r√©pertoire de logs
mkdir -p logs
echo "üìÅ R√©pertoire de logs cr√©√©"
```

#### Script principal API
```bash
#!/usr/bin/env bash
# openweather_api.sh

set -euo pipefail

# Configuration
CONFIG_FILE=".env"
LOG_DIR="logs"

# Chargement de la configuration
if [[ -f "$CONFIG_FILE" ]]; then
    source "$CONFIG_FILE"
else
    echo "‚ùå Fichier .env manquant. Ex√©cutez ./install.sh" >&2
    exit 1
fi

# Validation de la cl√© API
if [[ -z "${API_KEY:-}" ]]; then
    echo "‚ùå Cl√© API manquante dans .env" >&2
    exit 1
fi

# Fonction de logging s√©curis√©
log_request() {
    local url="$1"
    local safe_url=$(echo "$url" | sed "s/appid=[^&]*/appid=***HIDDEN***/g")
    echo "[$(date +'%Y-%m-%d %H:%M:%S')] [REQUEST] $safe_url" >> "$LOG_DIR/api_requests.log"
}

log_response() {
    local status="$1"
    local data="$2"
    echo "[$(date +'%Y-%m-%d %H:%M:%S')] [RESPONSE] HTTP: $status - Data: $data" >> "$LOG_DIR/api_responses.log"
}

log_error() {
    local error="$1"
    echo "[$(date +'%Y-%m-%d %H:%M:%S')] [ERROR] $error" >> "$LOG_DIR/errors.log"
}

# Fonction principale
get_weather() {
    local city="${1:-$DEFAULT_CITY}"
    local units="${2:-$DEFAULT_UNITS}"
    
    # Validation de l'entr√©e
    if [[ ! "$city" =~ ^[a-zA-Z\ \-,]+$ ]]; then
        log_error "Nom de ville invalide: $city"
        echo "‚ùå Nom de ville invalide" >&2
        return 1
    fi
    
    # Construction de l'URL
    local url="https://api.openweathermap.org/data/2.5/weather?q=${city}&units=${units}&lang=fr&appid=${API_KEY}"
    
    # Logging de la requ√™te
    log_request "$url"
    
    # Appel API avec gestion d'erreurs
    local response
    local http_code
    
    response=$(curl -s -w "\n%{http_code}" --max-time 10 "$url" 2>/dev/null)
    http_code=$(echo "$response" | tail -n1)
    local json_data=$(echo "$response" | head -n -1)
    
    # Validation de la r√©ponse HTTP
    case "$http_code" in
        200)
            # Validation JSON
            if ! echo "$json_data" | jq . >/dev/null 2>&1; then
                log_error "R√©ponse JSON invalide"
                echo "‚ùå Erreur de format de donn√©es" >&2
                return 1
            fi
            
            log_response "$http_code" "$json_data"
            
            # Extraction et affichage des donn√©es
            local temp=$(echo "$json_data" | jq -r '.main.temp')
            local description=$(echo "$json_data" | jq -r '.weather[0].description')
            local humidity=$(echo "$json_data" | jq -r '.main.humidity')
            
            echo "üå§Ô∏è M√©t√©o pour $city"
            echo "üå°Ô∏è Temp√©rature: ${temp}¬∞C"
            echo "‚òÅÔ∏è Conditions: $description"
            echo "üíß Humidit√©: ${humidity}%"
            ;;
        401)
            log_error "Cl√© API invalide (HTTP 401)"
            echo "‚ùå Cl√© API invalide" >&2
            return 1
            ;;
        404)
            log_error "Ville non trouv√©e: $city (HTTP 404)"
            echo "‚ùå Ville '$city' non trouv√©e" >&2
            return 1
            ;;
        *)
            log_error "Erreur API (HTTP $http_code)"
            echo "‚ùå Erreur API (Code: $http_code)" >&2
            return 1
            ;;
    esac
}

# Interface utilisateur
case "${1:-current}" in
    "current")
        get_weather "${2:-}" "${3:-}"
        ;;
    "config")
        echo "üìã Configuration actuelle:"
        echo "Ville par d√©faut: ${DEFAULT_CITY}"
        echo "Unit√©s: ${DEFAULT_UNITS}"
        echo "Logs: $LOG_DIR/"
        ;;
    "help")
        echo "Usage: $0 [current|config|help] [ville] [unit√©s]"
        echo "Exemples:"
        echo "  $0 current"
        echo "  $0 current 'New York'"
        echo "  $0 current 'Tokyo' imperial"
        ;;
    *)
        echo "‚ùå Commande inconnue. Utilisez '$0 help'" >&2
        exit 1
        ;;
esac
```

### Fonctionnalit√©s de s√©curit√© impl√©ment√©es

- ‚úÖ **Cl√© API s√©curis√©e** : Stockage dans `.env`, masquage dans les logs
- ‚úÖ **Validation stricte** : V√©rification des entr√©es utilisateur
- ‚úÖ **Gestion d'erreurs HTTP** : Codes 200, 401, 404, etc.
- ‚úÖ **Logging complet** : Requ√™tes, r√©ponses et erreurs s√©par√©es
- ‚úÖ **Timeouts** : Protection contre les blocages
- ‚úÖ **Validation JSON** : V√©rification de l'int√©grit√© des donn√©es

### Structure des logs

```
logs/
‚îú‚îÄ‚îÄ api_requests.log    # Requ√™tes avec URLs (cl√©s masqu√©es)
‚îú‚îÄ‚îÄ api_responses.log   # R√©ponses HTTP et donn√©es JSON
‚îî‚îÄ‚îÄ errors.log          # Erreurs et avertissements
```